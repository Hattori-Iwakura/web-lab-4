@* filepath: c:\Users\ASUS\Desktop\web-lab-4\Areas\Admin\Views\Home\Index.cshtml *@
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<!-- Dashboard Header -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-tachometer-alt"></i> Dashboard Overview
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-calendar"></i> This Week
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Today</a></li>
                <li><a class="dropdown-item" href="#">This Week</a></li>
                <li><a class="dropdown-item" href="#">This Month</a></li>
                <li><a class="dropdown-item" href="#">This Year</a></li>
            </ul>
        </div>
        <button type="button" class="btn btn-sm btn-primary">
            <i class="fas fa-download"></i> Export Report
        </button>
    </div>
</div>

<!-- Stats Cards Row -->
<div class="row mb-4">
    <!-- Total Products -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            Total Products
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalProducts">@(ViewBag.DashboardData?.TotalProducts ?? 0)</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-box fa-2x text-gray-300"></i>
                    </div>
                </div>
                <div class="row no-gutters align-items-center mt-2">
                    <div class="col">
                        <small class="text-success">
                            <i class="fas fa-arrow-up"></i> 12% from last month
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Total Orders -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Total Orders
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalOrders">@(ViewBag.DashboardData?.TotalOrders ?? 0)</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                    </div>
                </div>
                <div class="row no-gutters align-items-center mt-2">
                    <div class="col">
                        <small class="text-success">
                            <i class="fas fa-arrow-up"></i> 8% from last month
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monthly Revenue -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Monthly Revenue
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="monthlyRevenue">@((ViewBag.DashboardData?.MonthlyRevenue ?? 0).ToString("C"))</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                    </div>
                </div>
                <div class="row no-gutters align-items-center mt-2">
                    <div class="col">
                        <div class="progress progress-sm">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted">75% of monthly goal</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Orders -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            Pending Orders
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="pendingOrders">@(ViewBag.DashboardData?.PendingOrders ?? 0)</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clock fa-2x text-gray-300"></i>
                    </div>
                </div>
                <div class="row no-gutters align-items-center mt-2">
                    <div class="col">
                        <small class="text-warning">
                            <i class="fas fa-exclamation-triangle"></i> Needs attention
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts and Recent Activity Row -->
<div class="row">
    <!-- Sales Chart -->
    <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-chart-area"></i> Sales Overview
                </h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow">
                        <a class="dropdown-item" href="#">View Details</a>
                        <a class="dropdown-item" href="#">Download Report</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-area">
                    <canvas id="salesChart" width="100%" height="30"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Status Pie Chart -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-chart-pie"></i> Order Status
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-pie pt-4 pb-2">
                    <canvas id="orderStatusChart"></canvas>
                </div>
                <div class="mt-4 text-center small">
                    <span class="mr-2">
                        <i class="fas fa-circle text-primary"></i> Completed
                    </span>
                    <span class="mr-2">
                        <i class="fas fa-circle text-success"></i> Processing
                    </span>
                    <span class="mr-2">
                        <i class="fas fa-circle text-warning"></i> Pending
                    </span>
                    <span class="mr-2">
                        <i class="fas fa-circle text-danger"></i> Cancelled
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity and Quick Actions Row -->
<div class="row">
    <!-- Recent Orders -->
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-list"></i> Recent Orders
                </h6>
                <a href="~/Admin/Order" class="btn btn-sm btn-primary">View All</a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-sm" width="100%" cellspacing="0">
                        <thead class="table-light">
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrdersTable">
                            <tr>
                                <td colspan="5" class="text-center">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-bolt"></i> Quick Actions
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <a asp-area="Admin" asp-controller="Product" asp-action="Add" class="btn btn-outline-primary btn-block">
                            <i class="fas fa-plus"></i><br>
                            Add Product
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a asp-area="Admin" asp-controller="Category" asp-action="Add" class="btn btn-outline-success btn-block">
                            <i class="fas fa-tags"></i><br>
                            Add Category
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a asp-area="Admin" asp-controller="Order" asp-action="Index" class="btn btn-outline-warning btn-block">
                            <i class="fas fa-eye"></i><br>
                            View Orders
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="btn btn-outline-info btn-block" onclick="generateReport()">
                            <i class="fas fa-chart-bar"></i><br>
                            Generate Report
                        </a>
                    </div>
                </div>

                <!-- System Status -->
                <div class="mt-4">
                    <h6 class="font-weight-bold">System Status</h6>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>Server Load</span>
                            <span class="text-success">Normal</span>
                        </div>
                        <div class="progress progress-sm">
                            <div class="progress-bar bg-success" style="width: 45%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>Database</span>
                            <span class="text-success">Connected</span>
                        </div>
                        <div class="progress progress-sm">
                            <div class="progress-bar bg-success" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>Storage</span>
                            <span class="text-warning">75% Used</span>
                        </div>
                        <div class="progress progress-sm">
                            <div class="progress-bar bg-warning" style="width: 75%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Top Products Row -->
<div class="row">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-star"></i> Top Selling Products
                </h6>
            </div>
            <div class="card-body">
                <div class="row" id="topProductsContainer">
                    <div class="col-12 text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <p>Loading top products...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        $(document).ready(function() {
            loadDashboardData();
            initializeCharts();
        });

        function loadDashboardData() {
            // Load dashboard statistics
            $.ajax({
                url: '@Url.Action("GetDashboardStats", "Home")',
                type: 'GET',
                success: function(data) {
                    $('#totalProducts').text(data.totalProducts || 0);
                    $('#totalOrders').text(data.totalOrders || 0);
                    $('#monthlyRevenue').text('$' + (data.monthlyRevenue || 0).toLocaleString());
                    $('#pendingOrders').text(data.pendingOrders || 0);
                    
                    loadRecentOrders(data.recentOrders);
                    loadTopProducts(data.topProducts);
                },
                error: function() {
                    // Fallback data
                    $('#totalProducts').text('12');
                    $('#totalOrders').text('45');
                    $('#monthlyRevenue').text('$8,450');
                    $('#pendingOrders').text('3');
                    
                    loadSampleData();
                }
            });
        }

        function loadRecentOrders(orders) {
            const tbody = $('#recentOrdersTable');
            tbody.empty();
            
            if (orders && orders.length > 0) {
                orders.forEach(function(order) {
                    const statusClass = getStatusClass(order.status);
                    const row = `
                        <tr>
                            <td>#${order.id}</td>
                            <td>${order.customerName}</td>
                            <td>$${order.amount.toFixed(2)}</td>
                            <td><span class="badge ${statusClass}">${order.status}</span></td>
                            <td>${new Date(order.date).toLocaleDateString()}</td>
                        </tr>
                    `;
                    tbody.append(row);
                });
            } else {
                tbody.html('<tr><td colspan="5" class="text-center text-muted">No recent orders</td></tr>');
            }
        }

        function loadTopProducts(products) {
            const container = $('#topProductsContainer');
            container.empty();
            
            if (products && products.length > 0) {
                products.forEach(function(product) {
                    const productCard = `
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                            <div class="card border-left-success h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                ${product.name}
                                            </div>
                                            <div class="h6 mb-0 font-weight-bold text-gray-800">
                                                ${product.salesCount} sold
                                            </div>
                                            <div class="text-xs text-gray-500">
                                                $${product.revenue.toFixed(2)} revenue
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.append(productCard);
                });
            } else {
                container.html(`
                    <div class="col-12 text-center text-muted">
                        <i class="fas fa-box fa-2x mb-2"></i>
                        <p>No sales data available</p>
                    </div>
                `);
            }
        }

        function loadSampleData() {
            // Sample recent orders
            const sampleOrders = [
                { id: 1001, customerName: 'John Doe', amount: 156.78, status: 'Completed', date: new Date() },
                { id: 1002, customerName: 'Jane Smith', amount: 89.50, status: 'Processing', date: new Date() },
                { id: 1003, customerName: 'Bob Johnson', amount: 234.99, status: 'Pending', date: new Date() }
            ];
            loadRecentOrders(sampleOrders);

            // Sample top products
            const sampleProducts = [
                { name: 'Product A', salesCount: 45, revenue: 2250.50 },
                { name: 'Product B', salesCount: 32, revenue: 1890.75 },
                { name: 'Product C', salesCount: 28, revenue: 1456.20 },
                { name: 'Product D', salesCount: 21, revenue: 987.45 }
            ];
            loadTopProducts(sampleProducts);
        }

        function getStatusClass(status) {
            switch(status.toLowerCase()) {
                case 'completed': return 'bg-success';
                case 'processing': return 'bg-primary';
                case 'pending': return 'bg-warning';
                case 'cancelled': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Sales ($)',
                        data: [1200, 1900, 3000, 5000, 2000, 3000, 4500, 3200, 2800, 4100, 3600, 4200],
                        borderColor: 'rgb(78, 115, 223)',
                        backgroundColor: 'rgba(78, 115, 223, 0.1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Order Status Pie Chart
            const orderCtx = document.getElementById('orderStatusChart').getContext('2d');
            new Chart(orderCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Processing', 'Pending', 'Cancelled'],
                    datasets: [{
                        data: [65, 20, 10, 5],
                        backgroundColor: ['#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'],
                        hoverBackgroundColor: ['#17a673', '#2c9faf', '#dda20a', '#be2617'],
                        hoverBorderColor: "rgba(234, 236, 244, 1)",
                    }],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    cutout: '80%'
                }
            });
        }

        function generateReport() {
            alert('Report generation feature coming soon!');
        }

        // Auto-refresh dashboard every 5 minutes
        setInterval(function() {
            loadDashboardData();
        }, 300000);
    </script>
}

@section Styles {
    <style>
        .border-left-primary {
            border-left: 0.25rem solid #4e73df !important;
        }

        .border-left-success {
            border-left: 0.25rem solid #1cc88a !important;
        }

        .border-left-info {
            border-left: 0.25rem solid #36b9cc !important;
        }

        .border-left-warning {
            border-left: 0.25rem solid #f6c23e !important;
        }

        .text-xs {
            font-size: 0.7rem;
        }

        .text-gray-800 {
            color: #5a5c69 !important;
        }

        .text-gray-300 {
            color: #dddfeb !important;
        }

        .text-gray-400 {
            color: #c5ccd3 !important;
        }

        .text-gray-500 {
            color: #b7b9cc !important;
        }

        .progress-sm {
            height: 0.375rem;
        }

        .btn-block {
            width: 100%;
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .card {
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;
        }

        .chart-area {
            position: relative;
            height: 320px;
        }

        .chart-pie {
            position: relative;
            height: 240px;
        }

        .no-gutters {
            margin-right: 0;
            margin-left: 0;
        }

        .no-gutters > .col,
        .no-gutters > [class*="col-"] {
            padding-right: 0;
            padding-left: 0;
        }

        @@media (max-width: 768px) {
            .btn-block {
                padding: 0.75rem;
            }
            
            .h5 {
                font-size: 1.1rem;
            }
        }
    </style>
}